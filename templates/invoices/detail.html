{% extends 'base.html' %}

{% block title %}{{ invoice.invoice_number }} - Facturation{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <div class="mb-8 flex justify-between items-start">
        <div>
            <h1 class="text-4xl font-bold text-gray-900">ðŸ“„ Facture {{ invoice.invoice_number }}</h1>
            <p class="text-gray-600 mt-2">Client: <span class="font-semibold">{{ invoice.client.name }}</span></p>
        </div>
        <div class="flex gap-3">
            <a href="{% url 'core:invoice_list' %}" class="btn-outline py-2 px-4">
                <i class="fas fa-arrow-left"></i> Retour
            </a>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-8">
        <div class="flex flex-wrap gap-3">
            <a href="{% url 'core:invoice_edit' invoice.pk %}" class="btn-primary py-2 px-4">
                <i class="fas fa-edit"></i> Ã‰diter
            </a>
            <a href="{% url 'core:invoice_add_item' invoice.pk %}" class="btn-success py-2 px-4">
                <i class="fas fa-plus"></i> Ajouter Article
            </a>
            <a href="{% url 'core:invoice_export_pdf' invoice.pk %}" class="btn-warning py-2 px-4">
                <i class="fas fa-file-pdf"></i> PDF
            </a>
            <a href="{% url 'core:invoice_export_excel' invoice.pk %}" class="btn-info py-2 px-4">
                <i class="fas fa-file-excel"></i> Excel
            </a>
            <a href="{% url 'core:invoice_delete' invoice.pk %}" class="btn-danger py-2 px-4">
                <i class="fas fa-trash"></i> Supprimer
            </a>
        </div>
    </div>

    <!-- Invoice Details -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
        <div class="grid grid-cols-3 gap-6 mb-8">
            <div class="border-l-4 border-blue-500 pl-4">
                <h3 class="font-semibold text-gray-700 mb-2 text-sm uppercase">Client</h3>
                <p class="text-gray-900 font-bold">{{ invoice.client.name }}</p>
                <p class="text-gray-600 text-sm">{{ invoice.client.email }}</p>
                <p class="text-gray-600 text-sm">{{ invoice.client.phone }}</p>
            </div>
            <div class="border-l-4 border-green-500 pl-4">
                <h3 class="font-semibold text-gray-700 mb-2 text-sm uppercase">Dates</h3>
                <p class="text-gray-900"><strong>Ã‰mise:</strong> {{ invoice.invoice_date|date:"d/m/Y" }}</p>
                <p class="text-gray-900"><strong>Ã‰chÃ©ance:</strong> {{ invoice.due_date|date:"d/m/Y" }}</p>
            </div>
            <div class="border-l-4 border-purple-500 pl-4">
                <h3 class="font-semibold text-gray-700 mb-2 text-sm uppercase">Statut</h3>
                <span class="px-4 py-2 rounded-full text-sm font-semibold 
                    {% if invoice.status == 'paid' %}bg-green-100 text-green-800
                    {% elif invoice.status == 'sent' %}bg-blue-100 text-blue-800
                    {% elif invoice.status == 'draft' %}bg-yellow-100 text-yellow-800
                    {% else %}bg-gray-100 text-gray-800{% endif %}">
                    {{ invoice.get_status_display }}
                </span>
            </div>
        </div>

        <!-- Items Table -->
        <div class="mb-8">
            <h3 class="text-xl font-bold text-gray-900 mb-4">Articles</h3>
            {% if items %}
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-100 border-b-2 border-gray-300">
                            <tr>
                                <th class="text-left py-3 px-4">Produit</th>
                                <th class="text-center py-3 px-4">QuantitÃ©</th>
                                <th class="text-right py-3 px-4">Prix Unitaire</th>
                                <th class="text-right py-3 px-4">TVA</th>
                                <th class="text-right py-3 px-4">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                            <tr class="border-b hover:bg-gray-50">
                                <td class="py-3 px-4">
                                    <strong>{{ item.product.name }}</strong>
                                    <p class="text-sm text-gray-600">{{ item.product.sku }}</p>
                                </td>
                                <td class="text-center py-3 px-4">{{ item.quantity }}</td>
                                <td class="text-right py-3 px-4">{{ item.unit_price|floatformat:2 }} â‚¬</td>
                                <td class="text-right py-3 px-4">{{ item.tax_amount|floatformat:2 }} â‚¬</td>
                                <td class="text-right py-3 px-4 font-bold">{{ item.subtotal|floatformat:2 }} â‚¬</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="bg-yellow-50 border border-yellow-200 rounded p-4 text-yellow-800">
                    <i class="fas fa-info-circle"></i> Aucun article. <a href="{% url 'core:invoice_add_item' invoice.pk %}" class="underline font-bold">Ajouter un article</a>
                </div>
            {% endif %}
        </div>

        <!-- Totals -->
        <div class="flex justify-end">
            <div class="w-80 bg-gray-50 rounded-lg p-6">
                <div class="flex justify-between py-2 mb-2">
                    <span class="text-gray-700">Sous-total:</span>
                    <span class="text-gray-900">{{ invoice.subtotal|floatformat:2 }} â‚¬</span>
                </div>
                <div class="flex justify-between py-2 mb-2 border-b-2 border-gray-200">
                    <span class="text-gray-700">TVA (20%):</span>
                    <span class="text-gray-900">{{ invoice.tax_amount|floatformat:2 }} â‚¬</span>
                </div>
                <div class="flex justify-between py-3 text-xl">
                    <span class="font-bold text-gray-900">Total TTC:</span>
                    <span class="font-bold text-2xl text-blue-600">{{ invoice.total|floatformat:2 }} â‚¬</span>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .btn-info {
        @apply bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg font-semibold transition;
    }
</style>
{% endblock %}
